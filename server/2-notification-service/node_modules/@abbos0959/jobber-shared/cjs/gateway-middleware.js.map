{"version":3,"file":"gateway-middleware.js","names":["_jsonwebtoken","_interopRequireDefault","require","_errorHandler","obj","__esModule","default","tokens","verifyGatewayRequest","req","_res","next","_req$headers","_req$headers2","headers","gatewaytoken","NotAuthorizedError","token","payload","JWT","verify","includes","id","error"],"sources":["../../src/gateway-middleware.ts"],"sourcesContent":["import JWT from 'jsonwebtoken';\nimport { Request, Response, NextFunction } from 'express';\nimport { NotAuthorizedError } from './error-handler';\n\nconst tokens: string[] = [\n  'auth',\n  'seller',\n  'gig',\n  'search',\n  'buyer',\n  'message',\n  'order',\n  'review',\n];\n\nexport function verifyGatewayRequest(\n  req: Request,\n  _res: Response,\n  next: NextFunction\n): void {\n  if (!req.headers?.gatewaytoken) {\n    throw new NotAuthorizedError(\n      'Invalid request',\n      'verifyGatewayRequest() method: Request not coming from api gateway'\n    );\n  }\n  const token: string = req.headers?.gatewaytoken as string;\n  if (!token) {\n    throw new NotAuthorizedError(\n      'Invalid request',\n      'verifyGatewayRequest() method: Request not coming from api gateway'\n    );\n  }\n\n  try {\n    const payload: { id: string; iat: number } = JWT.verify(\n      token,\n      'secret'\n    ) as { id: string; iat: number };\n    if (!tokens.includes(payload.id)) {\n      throw new NotAuthorizedError(\n        'Invalid request',\n        'verifyGatewayRequest() method: Request payload is invalid'\n      );\n    }\n  } catch (error) {\n    throw new NotAuthorizedError(\n      'Invalid request',\n      'verifyGatewayRequest() method: Request not coming from api gateway'\n    );\n  }\n  next();\n}\n"],"mappings":";;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,aAAA,GAAAD,OAAA;AAAqD,SAAAD,uBAAAG,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAErD,MAAMG,MAAgB,GAAG,CACvB,MAAM,EACN,QAAQ,EACR,KAAK,EACL,QAAQ,EACR,OAAO,EACP,SAAS,EACT,OAAO,EACP,QAAQ,CACT;AAEM,SAASC,oBAAoBA,CAClCC,GAAY,EACZC,IAAc,EACdC,IAAkB,EACZ;EAAA,IAAAC,YAAA,EAAAC,aAAA;EACN,IAAI,GAAAD,YAAA,GAACH,GAAG,CAACK,OAAO,aAAXF,YAAA,CAAaG,YAAY,GAAE;IAC9B,MAAM,IAAIC,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;EACA,MAAMC,KAAa,IAAAJ,aAAA,GAAGJ,GAAG,CAACK,OAAO,qBAAXD,aAAA,CAAaE,YAAsB;EACzD,IAAI,CAACE,KAAK,EAAE;IACV,MAAM,IAAID,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;EAEA,IAAI;IACF,MAAME,OAAoC,GAAGC,qBAAG,CAACC,MAAM,CACrDH,KAAK,EACL,QACF,CAAgC;IAChC,IAAI,CAACV,MAAM,CAACc,QAAQ,CAACH,OAAO,CAACI,EAAE,CAAC,EAAE;MAChC,MAAM,IAAIN,gCAAkB,CAC1B,iBAAiB,EACjB,2DACF,CAAC;IACH;EACF,CAAC,CAAC,OAAOO,KAAK,EAAE;IACd,MAAM,IAAIP,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;EACAL,IAAI,CAAC,CAAC;AACR"}